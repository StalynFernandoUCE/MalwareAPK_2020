--------------------------------
-- @module init

--[[--

yy framework åˆå§‹åŒ–

è½½å…¥ yy framework é¢„å®šä¹‰çš„å¸¸é‡ã€æ¨¡å—ã€‚

### å¸¸é‡

åœ¨åˆå§‹åŒ–æ¡†æ¶ä¹‹å‰ï¼Œå¯ä»¥å®šä¹‰ä»¥ä¸‹å¸¸é‡ï¼š

-   DEBUG: è®¾ç½®æ¡†æ¶çš„è°ƒè¯•è¾“å‡ºçº§åˆ«

    ```lua
    DEBUG = 0           -- ä¸è¾“å‡ºä»»ä½•è°ƒè¯•ä¿¡æ¯ï¼ˆé»?è®¤å€¼ï¼‰
    DEBUG = 1           -- è¾“å‡ºåŸºæœ¬çš„è°ƒè¯•ä¿¡æ¯
    DEBUG = 2           -- è¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
    ```

-   DEBUG_FPS: è®¾ç½®æ?¯å¦åœ¨ç”»é¢ä¸­æ?¾ç¤ºæ¸²æŸ“å¸§ç‡ç­‰ä¿¡æ¯

    ```lua
    DEBUG_FPS = false   -- ä¸æ?¾ç¤ºï¼ˆé»?è®¤å€¼ï¼‰
    DEBUG_FPS = true    -- æ?¾ç¤º
    ```

-   DEBUG_MEM: è®¾ç½®æ?¯å¦è¾“å‡ºå†…å­?å ç”¨ä¿¡æ¯

    ```lua
    DEBUG_MEM = false   -- ä¸è¾“å‡ºï¼ˆé»?è®¤å€¼ï¼‰
    DEBUG_MEM = true    -- æ¯ 10 ç§’è¾“å‡ºä¸€æ¬¡
    ```
<br />

### è‡ªåŠ¨è½½å…¥çš„æ¨¡å—

æ¡†æ¶åˆå§‹åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨è½½å…¥ä»¥ä¸‹åŸºæœ¬æ¨¡å—ï¼š

-   debug: è°ƒè¯•æ¥å£
-   functions: æä¾›ä¸€ç»„å¸¸ç”¨çš„å‡½æ•°ï¼Œä»¥åŠå¯¹ Lua æ ‡å‡†åº“çš„æ‰©å±•
-   cocos2dx: å¯¹ cocos2d-x C++ æ¥å£çš„å°è£…å’Œæ‰©å±•
-   device: é’ˆå¯¹è®¾å¤‡æ¥å£çš„æ‰©å±•
-   display: åˆ›å»ºåœºæ™¯ã€å›¾åƒã€åŠ¨ç”»çš„æ¥å£
-   audio: éŸ³ä¹å’ŒéŸ³æ•ˆçš„æ¥å£
-   network: ç½‘ç»œç›¸å…³çš„æ¥å£
-   crypto: åŠ å¯†ç›¸å…³çš„æ¥å£
-   json: JSON çš„ç¼–ç å’Œè§£ç æ¥å£
-   cc: quick æ¡†æ¶æ‰©å±•çš„åŸºç¡€ç±»å’Œç»„ä»¶

]]

print("===========================================================")
print("              LOAD YY FRAMEWORK")
print("===========================================================")

if type(DEBUG) ~= "number" then DEBUG = 0 end
if type(DEBUG_FPS) ~= "boolean" then DEBUG_FPS = false end
if type(DEBUG_MEM) ~= "boolean" then DEBUG_MEM = false end

----
local CURRENT_MODULE_NAME = ...

cc = cc or {}
cc.PACKAGE_NAME = string.sub(CURRENT_MODULE_NAME, 1, -6)

require("cocosext.msg.init")
require("cocosext.language.init")
require("cocosext.common.init")
require("cocosext.net.init")

printInfo("")
printInfo("# DEBUG = "..DEBUG)
printInfo("#")

local sharedTextureCache = cc.Director:getInstance():getTextureCache()
local sharedDirector = cc.Director:getInstance()

-- FPS
if DEBUG_FPS then
    sharedDirector:setDisplayStats(true)
else
    sharedDirector:setDisplayStats(false)
end

-- å†…å­?ä¿¡æ¯æƒ…å†µ
if DEBUG_MEM then
    local sharedTextureCache = cc.Director:getInstance():getTextureCache()
    --[[--
    @ignore
    ]]
    local function showMemoryUsage()
        printInfo(string.format("LUA VM MEMORY USED: %0.2f KB", collectgarbage("count")))
        printInfo(sharedTextureCache:getCachedTextureInfo())
        printInfo("---------------------------------------------------")
    end
    sharedDirector:getScheduler():scheduleScriptFunc(showMemoryUsage, DEBUG_MEM_INTERVAL or 10.0, false)
end
